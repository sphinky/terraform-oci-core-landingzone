resource "oci_identity_user" "user" {
  name           = "prisma-cloud-user"
  description    = "user created by terraform"
  compartment_id = "${local.tenancy_ocid}"
  email = "noreply@edwardjones.com"
}

resource "oci_identity_api_key" "api-key" {
  user_id = oci_identity_user.user.id

  key_value = <<EOF
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3GjTJlCefWxm1FT7WryztpAxJcSOSax4
DVHqk90LylRKMhHpKgwu2MjBYVlmvOpW6O00zWFJ7MlLAYhYYHUW9Ah+nv1RyXeA3wf1aNopoA/3
WL5vZG7nS1NFyjKcAWYzstp8l+ZX7Fw5oNaj8Vh5bQl4GmTAelrq1YExKX1fUOkHLZ8re5ZuiCZY
C6Hz5HU5UAnorbcq2ZBxvmLJbM20/b6lP9dfHxmk9n+F0++yaQw2lbbTm7uyGHvgvgaUsXbvDLiO
gmVVMInU6rgllsx9kJRTkpODooA4inykgak+tj8h2EjxTlctyFz7assFs2aoGxelFx5hI9Wtr4cq
2wBFCQIDAQAA
-----END PUBLIC KEY-----
EOF
}

resource "oci_identity_group" "group" {
  name           = "prisma-cloud-group"
  description    = "group created by terraform"
  compartment_id = oci_identity_user.user.compartment_id
}

resource "oci_identity_user_group_membership" "user-group-membership" {
  compartment_id = oci_identity_user.user.compartment_id
  user_id        = oci_identity_user.user.id
  group_id       = oci_identity_group.group.id
}

resource "oci_identity_policy" "policy" {
  name           = "prisma-cloud-policy"
  description    = "policy created by terraform"
  compartment_id = oci_identity_user.user.compartment_id

  statements = [
    "Allow group ${oci_identity_group.group.name} to {SERVICE_CONNECTOR_INSPECT,SERVICE_CONNECTOR_READ,FN_APP_LIST,FN_APP_READ,FN_FUNCTION_LIST,FN_FUNCTION_READ,REPOSITORY_INSPECT,REPOSITORY_READ,CATALOG_INSPECT,CATALOG_READ,STREAM_INSPECT,STREAM_READ,STREAM_POOL_INSPECT,STREAM_POOL_READ,DB_SYSTEM_INSPECT,DB_HOME_INSPECT,DATABASE_INSPECT,DATAFLOW_APPLICATION_INSPECT,DATAFLOW_APPLICATION_READ,DIS_WORKSPACE_INSPECT,DIS_WORKSPACE_READ,IDENTITY_PROVIDER_INSPECT,DATA_SCIENCE_PROJECT_INSPECT,DATA_SCIENCE_PROJECT_READ,VNIC_ATTACHMENT_READ,VNIC_READ,DNS_TSIG_KEY_INSPECT,DNS_TSIG_KEY_READ,WAAS_POLICY_INSPECT,WAAS_POLICY_READ,WAAS_ADDRESS_LIST_INSPECT,WAAS_ADDRESS_LIST_READ,CERTIFICATE_AUTHORITY_INSPECT,CERTIFICATE_AUTHORITY_READ,WAF_NETWORK_ADDRESS_LIST_INSPECT,WAF_NETWORK_ADDRESS_LIST_READ,MYSQL_INSTANCE_READ,MYSQL_INSTANCE_INSPECT,DNS_ZONE_INSPECT,BDS_INSPECT,BDS_READ,BASTION_INSPECT,BASTION_READ,BASTION_SESSION_READ,BASTION_SESSION_INSPECT,API_GATEWAY_LIST,API_GATEWAY_READ,SERVICE_GATEWAY_READ,NAT_GATEWAY_READ,LOCAL_PEERING_GATEWAY_READ,DRG_READ,DRG_ATTACHMENT_READ,INTERNET_GATEWAY_READ,ROUTE_TABLE_READ,SUBNET_READ,LOAD_BALANCER_INSPECT,BACKUP_POLICY_ASSIGNMENT_INSPECT,VOLUME_BACKUP_INSPECT,VOLUME_BACKUP_READ,VOLUME_INSPECT,OBJECTSTORAGE_NAMESPACE_READ,ONS_TOPIC_INSPECT,ONS_TOPIC_READ,ONS_SUBSCRIPTION_INSPECT,EXPORT_SET_INSPECT,EXPORT_SET_READ,FILE_SYSTEM_INSPECT,FILE_SYSTEM_READ,BUCKET_INSPECT,BUCKET_READ,SECURITY_LIST_READ,NETWORK_SECURITY_GROUP_INSPECT,NETWORK_SECURITY_GROUP_READ,VCN_READ,BOOT_VOLUME_BACKUP_INSPECT,BOOT_VOLUME_BACKUP_READ,INSTANCE_INSPECT,INSTANCE_READ,USER_INSPECT,USER_READ,POLICY_READ,GROUP_INSPECT,CREDENTIAL_INSPECT,COMPARTMENT_INSPECT,AUTHENTICATION_POLICY_INSPECT,WAF_POLICY_INSPECT,WAF_POLICY_READ,EVENTRULE_LIST,EVENTRULE_READ,LOG_GROUP_INSPECT,LOG_GROUP_READ,CLUSTER_INSPECT,CLUSTER_READ,CLUSTER_NODE_POOL_INSPECT,CLUSTER_NODE_POOL_READ,API_DEPLOYMENT_LIST,API_DEPLOYMENT_READ,NETWORK_LOAD_BALANCER_INSPECT,NETWORK_LOAD_BALANCER_READ,USAGE_BUDGET_INSPECT,USAGE_BUDGET_READ,ANALYTICS_INSTANCE_INSPECT,ANALYTICS_INSTANCE_READ,IPSEC_CONNECTION_READ,VAULT_INSPECT,VAULT_READ,VSS_HOSTSCANTARGET_INSPECT,VSS_HOSTSCANTARGET_READ,VSS_HOSTSCANRECIPE_INSPECT,VSS_HOSTSCANRECIPE_READ,NOSQL_TABLE_INSPECT,NOSQL_TABLE_READ,DATA_SAFE_PRIVATE_ENDPOINT_INSPECT,DATA_SAFE_PRIVATE_ENDPOINT_READ,DATA_SAFE_TARGET_DATABASE_READ,DATA_SAFE_TARGET_DATABASE_INSPECT,DYNAMIC_GROUP_INSPECT,CERTIFICATE_INSPECT,CERTIFICATE_READ,SECURITY_ZONE_INSPECT,SECURITY_ZONE_READ,SECURITY_RECIPE_INSPECT,SECURITY_RECIPE_READ,DATA_LABELING_DATASET_INSPECT,DATA_LABELING_DATASET_READ,FLEET_INSPECT,FLEET_READ,MOUNT_TARGET_INSPECT,MOUNT_TARGET_READ,AI_SERVICE_VISION_MODEL_INSPECT,AI_SERVICE_VISION_MODEL_READ,AI_SERVICE_VISION_PROJECT_INSPECT,AI_SERVICE_VISION_PROJECT_READ,AI_SERVICE_SPEECH_TRANSCRIPTION_JOB_INSPECT,AI_SERVICE_SPEECH_TRANSCRIPTION_JOB_READ,MESH_ACCESS_POLICY_LIST,MESH_ACCESS_POLICY_READ,MESH_VIRTUAL_DEPLOYMENT_LIST,MESH_VIRTUAL_DEPLOYMENT_READ,MESH_VIRTUAL_DEPLOYMENT_PROXY_CONFIG_READ,MESH_PROXY_DETAILS_READ,SERVICE_MESH_LIST,SERVICE_MESH_READ,AUTONOMOUS_DATABASE_INSPECT,MESH_VIRTUAL_SERVICE_ROUTE_TABLE_LIST,MESH_VIRTUAL_SERVICE_ROUTE_TABLE_READ,MESH_VIRTUAL_SERVICE_LIST,MESH_VIRTUAL_SERVICE_READ,MESH_INGRESS_GATEWAY_ROUTE_TABLE_LIST,MESH_INGRESS_GATEWAY_ROUTE_TABLE_READ,MESH_INGRESS_GATEWAY_LIST,MESH_INGRESS_GATEWAY_READ,DB_NODE_INSPECT,DB_NODE_QUERY,NETWORK_SECURITY_GROUP_LIST_SECURITY_RULES,VOLUME_GROUP_INSPECT,KEY_STORE_INSPECT,INSTANCE_IMAGE_INSPECT,INSTANCE_IMAGE_READ,PUBLIC_IP_READ,PRIVATE_IP_READ,VOLUME_ATTACHMENT_INSPECT,VOLUME_ATTACHMENT_READ,CLOUD_VM_CLUSTER_INSPECT,EXADATA_INFRASTRUCTURE_INSPECT,INTEGRATION_INSTANCE_INSPECT,INTEGRATION_INSTANCE_READ,VLAN_READ,SDDC_INSPECT,SDDC_READ,SDDC_INSPECT_ESXI_HOST,SDDC_READ_ESXI_HOST,CG_DETECTOR_RECIPE_INSPECT,CG_DETECTOR_RECIPE_READ,CG_TARGET_INSPECT,CG_TARGET_READ,CG_CONFIG_INSPECT,CG_CONFIG_READ,SERVICE_CATALOG_INSPECT,SERVICE_CATALOG_READ,WEB_APP_FIREWALL_INSPECT,WEB_APP_FIREWALL_READ,OBJECTSTORAGE_NAMESPACE_READ,BUCKET_INSPECT,BUCKET_READ,SECRET_INSPECT,VOLUME_ATTACHMENT_INSPECT,VOLUME_ATTACHMENT_READ,DATA_SAFE_READ,SECRET_INSPECT,SECRET_VERSION_INSPECT,KEY_INSPECT,KEY_READ} in tenancy"
  ]
}

output "user_ocid" {
  value = oci_identity_user.user.id
}
